<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Configurador POS</title>
    <style>
        body { font-family: sans-serif; background: #222; color: white; padding: 20px; }
        h2 { border-bottom: 2px solid #555; padding-bottom: 10px; }
        
        .editor-section { margin-bottom: 40px; }
        
        /* Grid visual */
        .config-grid { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
        .config-grid.vertical { width: 300px; } 

        .slot {
            width: 100px; height: 80px;
            background: #333; border: 2px dashed #555;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            cursor: pointer; position: relative;
            text-align: center; font-size: 12px;
        }
        .slot:hover { background: #444; border-color: #fff; }
        .slot .num { position: absolute; top: 2px; left: 5px; color: #777; font-size: 10px; }
        .slot.filled { background: #d4a017; color: black; border-style: solid; font-weight: bold; }
        
        button.save-btn {
            background: #28a745; color: white; border: none; padding: 15px 30px; 
            font-size: 18px; cursor: pointer; border-radius: 5px; position: fixed; bottom: 20px; right: 20px;
        }

        /* Modal simple */
        #selector-modal {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8); display: none;
            justify-content: center; align-items: center;
        }
        .modal-content { background: #fff; color: #000; padding: 20px; width: 400px; max-height: 80vh; overflow-y: auto; border-radius: 8px; }
        .option-btn {
            display: block; width: 100%; padding: 10px; margin: 5px 0;
            background: #eee; border: 1px solid #ccc; cursor: pointer; text-align: left;
        }
        .option-btn:hover { background: #ddd; }
    </style>
</head>
<body>

    <h1>üîß Configurador de Pantalla</h1>
    <p>Haz clic en un recuadro para asignar un bot√≥n. Usa "VAC√çO" para dejar un hueco.</p>

    <div class="editor-section">
        <h2>Barra Superior (Toolbar)</h2>
        <div class="config-grid" id="grid-top"></div>
    </div>

    <div class="editor-section">
        <h2>Panel Lateral (Pagos)</h2>
        <div class="config-grid vertical" id="grid-side"></div>
    </div>

    <button class="save-btn" onclick="saveConfig()">üíæ GUARDAR CAMBIOS</button>

    <div id="selector-modal">
        <div class="modal-content">
            <h3>Elige un bot√≥n para la posici√≥n <span id="current-slot-num"></span></h3>
            <div id="options-list"></div>
            <button onclick="closeModal()" style="margin-top:10px; padding:10px; width:100%">Cancelar</button>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        // Cargar configuraci√≥n existente o usar defecto
        let currentConfig = JSON.parse(localStorage.getItem('neronPosConfig')) || JSON.parse(JSON.stringify(DEFAULT_LAYOUT));
        let activeSlot = { list: null, index: null };

        // Renderizar grids
        function initEditor() {
            renderGrid('grid-top', currentConfig.topBar, 'topBar', 12); // 12 huecos arriba
            renderGrid('grid-side', currentConfig.sidePanel, 'sidePanel', 16); // 16 huecos lado
        }

        function renderGrid(domId, dataArray, arrayName, maxSlots) {
            const container = document.getElementById(domId);
            container.innerHTML = '';
            
            // Aseguramos que el array tenga el tama√±o visual correcto
            for(let i=0; i<maxSlots; i++) {
                const key = dataArray[i];
                const btnData = MASTER_BUTTONS[key];
                
                const div = document.createElement('div');
                div.className = key ? 'slot filled' : 'slot';
                div.innerHTML = `<span class="num">${i+1}</span>
                                 <span>${btnData ? btnData.label : '(Vac√≠o)'}</span>`;
                
                div.onclick = () => openSelector(arrayName, i);
                container.appendChild(div);
            }
        }

        // Abrir selector
        function openSelector(listName, index) {
            activeSlot = { list: listName, index: index };
            document.getElementById('current-slot-num').innerText = index + 1;
            
            const list = document.getElementById('options-list');
            list.innerHTML = `<button class="option-btn" onclick="selectItem(null)">üö´ (DEJAR VAC√çO)</button>`;
            
            Object.keys(MASTER_BUTTONS).forEach(key => {
                const btn = MASTER_BUTTONS[key];
                list.innerHTML += `<button class="option-btn" onclick="selectItem('${key}')">
                    <b>${btn.label}</b>
                </button>`;
            });

            document.getElementById('selector-modal').style.display = 'flex';
        }

        function selectItem(key) {
            // Actualizar modelo de datos
            currentConfig[activeSlot.list][activeSlot.index] = key;
            closeModal();
            initEditor(); // Re-renderizar
        }

        function closeModal() {
            document.getElementById('selector-modal').style.display = 'none';
        }

        function saveConfig() {
            localStorage.setItem('neronPosConfig', JSON.stringify(currentConfig));
            alert('‚úÖ Configuraci√≥n guardada. Recarga la p√°gina del POS.');
        }

        initEditor();
    </script>
</body>
</html>